# Victron Monitoring Tool

This is a monitoring tool for Victron Energy systems that sends alerts to a specified Telegram chat when certain conditions are met, such as grid down, low battery, or critical load. The tool is configurable and customizable to fit various use cases, and it has been tested on **Victron MultiPlus inverters series**.

## Features

- Monitors grid status, battery levels, voltage, and power on each phase.
- Sends customizable notifications to a Telegram chat.
- Configurable alert messages, voltage thresholds, and power limits.
- Adjustable quiet hours to mute notifications during specified periods.
- Configurable high and low voltage thresholds via the setup menu.
- Adjustable refresh period for system status checks.
- Supports both English and Ukrainian languages for alert messages.
- Option to enable or disable the service at startup.

## Installation

### Prerequisites

- Python 3.x
- `pip` (Python package installer)
- **Telegram bot token** (can be generated via the Telegram `@BotFather`)
- **Telegram channel ID** (you can use `@JsonDumpBot` in Telegram to retrieve the channel ID)

### Steps

1. **Download and Run the Install Script**

    Run the following command in your terminal to download and execute the installation script:

    ```bash
    sudo bash -c "$(curl -s https://raw.githubusercontent.com/Ostromogilski/victron-monitoring-tool/main/install.sh)"
    ```

    This script will install the necessary dependencies, make the Python script executable, and create a default `settings.ini` file if it doesn't already exist.

2. **Start the Application for Initial Configuration**

    After the installation, run the monitoring tool to enter the setup and configure your application:

    ```bash
    victron_monitor
    ```

3. **Complete the Initial Setup**

    Inside the application, follow these steps:

    1. Choose `1. Configuration` from the menu to enter the following details:
        - **Telegram bot token**
        - **Chat ID** (ID of your Telegram group or chat)
        - **Victron API URL** (you can get this from the Victron VRM portal)
        - **Victron API Key** (generated from your VRM account)
        - **Refresh period** (default is 5 seconds)
        - **Max power** (output in watts)
        - **Passthru current** (in amps)
        - **Nominal voltage** (default is 230V)
        - **Timezone** (e.g., `Europe/Kyiv`)
        - **Voltage high threshold** (e.g., `1.10` for 110% of nominal voltage)
        - **Voltage low threshold** (e.g., `0.90` for 90% of nominal voltage)

    2. Choose `3. Message language` to select between **English** or **Ukrainian** for the alerts.
    3. Choose `4. Set Quiet Hours` to configure the hours during which notifications will be muted.

4. **View Logs**

    To view the logs generated by the tool, select the `View Logs` option in the main menu.

5. **Run the Monitoring Tool**

    Once configured, the monitoring tool will start monitoring your Victron system based on the settings provided:

    ```bash
    victron_monitor
    ```

    The tool will continuously check the status of your Victron system and send alerts if any of the specified conditions are met, such as:
    - Grid down/up events.
    - Low/critical battery levels.
    - Voltage anomalies (high or low voltage on any phase).
    - Critical load conditions.

## Usage

The monitoring tool runs continuously, checking your Victron system status at regular intervals (based on the configured refresh period). Alerts are sent to your Telegram channel for any issues detected.

### Monitoring

You can monitor the following parameters:
- **Grid Status:** Detects when the grid goes down and comes back up.
- **Battery Levels:** Monitors for low or critical battery levels.
- **Voltage:** Checks input and output voltage levels on each phase.
- **Power Consumption:** Tracks power on each phase and sends alerts if critical load is detected.

### Quiet Hours

During quiet hours (if configured), notifications are sent silently without sound or alerts in Telegram. This is useful to avoid disturbances during specified periods.

### Adjustable Voltage Thresholds

You can adjust the voltage thresholds via the configuration menu, allowing flexibility to handle different inverter or grid conditions.

## Tested Devices

This tool has been tested on the **Victron MultiPlus inverters series**, however it should work on other Victron Energy systems as long as they are connected to the Victron VRM API.

## Logs

The tool logs all activities to a log file (`~/victron_monitor/victron_monitor.log`), and you can view the logs using the menu option.

The settings are stored in `~/victron_monitor/settings.ini`.

---